<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Asmbli Canvas</title>
    <script src="https://unpkg.com/konva@9/konva.min.js"></script>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="canvas-wrapper">
        <!-- Left Toolbar -->
        <div class="toolbar-left">
            <div class="tool-section">
                <div class="section-title">Tools</div>
                <div class="tool-grid">
                    <button class="tool-btn active" data-tool="select" title="Select (V)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M2 2v6h2V4h4V2H2zm16 0h-4v2h4v4h2V2h-2zM8 20H4v-4H2v6h6v-2zm8 0v2h6v-6h-2v4h-4z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="rectangle" title="Rectangle (R)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 3h18v18H3V3zm2 2v14h14V5H5z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="circle" title="Circle (C)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="text" title="Text (T)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M5 4h14v3h-2V6h-4v11h2v2h-6v-2h2V6H7v1H5V4z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="button" title="Button (B)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 6h16v2H4zm0 5h16v6H4z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="input" title="Input (I)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 6h16v12H4V6zm2 2v8h12V8H6z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="image" title="Image">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M5 5h14v14H5V5zm2 2v10h10V7H7zm2 2l2.5 3.01L13.5 10l3.5 4.5H7L9 9z"/>
                        </svg>
                    </button>
                    <button class="tool-btn" data-tool="card" title="Card">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M4 4h16v16H4V4zm2 2v12h12V6H6z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <div class="tool-section">
                <div class="section-title">Components</div>
                <div class="component-grid">
                    <button class="component-btn" data-component="button" data-variant="filled">Filled Button</button>
                    <button class="component-btn" data-component="button" data-variant="outlined">Outlined Button</button>
                    <button class="component-btn" data-component="card" data-variant="elevated">Card</button>
                    <button class="component-btn" data-component="textField" data-variant="outlined">Text Field</button>
                </div>
            </div>
            
            <div class="tool-section">
                <div class="section-title">Layers</div>
                <div class="layers-list" id="layers-list">
                    <!-- Layers will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Main Canvas Area -->
        <div class="canvas-main">
            <!-- Top Toolbar -->
            <div class="toolbar-top">
                <div class="toolbar-section">
                    <button class="action-btn" onclick="undoAction()" title="Undo (Ctrl+Z)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8z"/>
                        </svg>
                    </button>
                    <button class="action-btn" onclick="redoAction()" title="Redo (Ctrl+Y)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7l-3.6 3.6z"/>
                        </svg>
                    </button>
                    <div class="separator"></div>
                    <button class="action-btn" onclick="duplicateSelected()" title="Duplicate (Ctrl+D)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                        </svg>
                    </button>
                    <button class="action-btn" onclick="deleteSelected()" title="Delete (Del)">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                        </svg>
                    </button>
                </div>
                
                <div class="toolbar-section">
                    <div class="zoom-controls">
                        <button class="action-btn" onclick="zoomOut()" title="Zoom Out">−</button>
                        <span class="zoom-level" id="zoom-level">100%</span>
                        <button class="action-btn" onclick="zoomIn()" title="Zoom In">+</button>
                        <button class="action-btn" onclick="resetZoom()" title="Reset Zoom">⌂</button>
                    </div>
                </div>
                
                <div class="toolbar-section">
                    <div class="design-system-selector">
                        <label>Design System:</label>
                        <select id="design-system-select">
                            <option value="material3">Material Design 3</option>
                            <option value="asmbli">Asmbli Design System</option>
                            <option value="company-brand">Company Brand</option>
                        </select>
                    </div>
                </div>
                
                <div class="toolbar-section">
                    <button class="action-btn primary" onclick="exportCode()" title="Export Flutter Code">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                        Export
                    </button>
                    <button class="action-btn" onclick="saveCanvas()" title="Save Canvas">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,16A3,3 0 0,1 12,13A3,3 0 0,1 15,16A3,3 0 0,1 12,19M17,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V7L17,3Z"/>
                        </svg>
                    </button>
                    <button class="action-btn danger" onclick="clearCanvas()" title="Clear Canvas">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z"/>
                        </svg>
                    </button>
                </div>
            </div>
            
            <!-- Canvas Container -->
            <div class="canvas-container" id="canvas-container">
                <!-- Konva Stage will be inserted here -->
            </div>
        </div>
        
        <!-- Right Properties Panel -->
        <div class="properties-panel">
            <div class="panel-section">
                <div class="section-title">Properties</div>
                <div class="properties-content" id="properties-content">
                    <div class="no-selection">
                        Select an element to edit properties
                    </div>
                </div>
            </div>
            
            <div class="panel-section">
                <div class="section-title">Alignment</div>
                <div class="alignment-grid">
                    <button class="align-btn" onclick="alignElements('left')" title="Align Left">⫸</button>
                    <button class="align-btn" onclick="alignElements('center')" title="Align Center">⫼</button>
                    <button class="align-btn" onclick="alignElements('right')" title="Align Right">⫷</button>
                    <button class="align-btn" onclick="alignElements('top')" title="Align Top">⫴</button>
                    <button class="align-btn" onclick="alignElements('middle')" title="Align Middle">⫾</button>
                    <button class="align-btn" onclick="alignElements('bottom')" title="Align Bottom">⫵</button>
                </div>
            </div>
            
            <div class="panel-section">
                <div class="section-title">Design Tokens</div>
                <div class="tokens-content" id="tokens-content">
                    <!-- Design tokens will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Status Bar -->
    <div class="status-bar">
        <div class="status-left">
            <span id="status-message">Canvas Ready</span>
        </div>
        <div class="status-right">
            <span id="element-count">0 elements</span>
            <span class="separator">|</span>
            <span id="canvas-size">800×600</span>
        </div>
    </div>
    
    <!-- Code Export Modal -->
    <div class="modal" id="export-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Export Flutter Code</h3>
                <button class="modal-close" onclick="closeExportModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <label>
                        <input type="checkbox" id="include-tokens" checked> Include Design Tokens
                    </label>
                    <label>
                        <input type="checkbox" id="componentize" checked> Create Components
                    </label>
                </div>
                <div class="code-preview">
                    <pre><code id="generated-code">// Flutter code will appear here</code></pre>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn" onclick="copyCode()">Copy Code</button>
                <button class="action-btn primary" onclick="downloadCode()">Download File</button>
            </div>
        </div>
    </div>
    
    <script src="canvas.js"></script>
</body>
</html>